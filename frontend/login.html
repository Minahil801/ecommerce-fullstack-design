<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - Brand</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body style="background:#f5f7ff;">

<!-- TOP BAR -->
<div class="topbar">
  <div class="container topbar-inner">
    <div class="topbar-left"><span><i class="fa fa-phone"></i> +1 234 567 890</span></div>
    <div class="topbar-right"><a href="#">Help</a></div>
  </div>
</div>

<!-- NAVBAR -->
<header class="navbar">
  <div class="container navbar-inner">
    <div class="logo"><a href="index.html"><i class="fa fa-bolt"></i> <span>Brand</span></a></div>
    <div class="nav-icons" style="margin-left:auto;">
      <a href="cart.html" class="nav-icon cart-icon">
        <i class="fa fa-shopping-cart"></i><span>Cart</span>
        <span class="badge" id="cartBadge">0</span>
      </a>
    </div>
  </div>
</header>

<!-- AUTH PAGE -->
<div class="auth-page">
  <div id="loginCard" class="auth-card">
    <h2>Welcome Back!</h2>
    <p>Login to your Brand account</p>

    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="loginEmail" placeholder="you@example.com"/>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="••••••••"/>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;">
        <input type="checkbox" style="accent-color:#0D6EFD;"> Remember me
      </label>
      <a href="#" style="font-size:13px;color:#0D6EFD;">Forgot password?</a>
    </div>

    <button class="auth-btn" onclick="login()">Login</button>



    <div class="auth-switch">
      Don't have an account? <a href="#" onclick="toggleAuth()">Register here</a>
    </div>

    <div id="loginMsg" style="text-align:center;margin-top:12px;font-size:13px;"></div>
  </div>

  <!-- REGISTER CARD -->
  <div id="registerCard" class="auth-card" style="display:none;">
    <h2>Create Account</h2>
    <p>Join Brand and start shopping today</p>

    <div class="form-group">
      <label>Full Name</label>
      <input type="text" id="regName" placeholder="John Doe"/>
    </div>
    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="regEmail" placeholder="you@example.com"/>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="regPassword" placeholder="Create a strong password"/>
    </div>
    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" id="regConfirm" placeholder="Repeat your password"/>
    </div>

    <label style="display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;margin-bottom:12px;">
      <input type="checkbox" id="terms" style="accent-color:#0D6EFD;">
      I agree to the <a href="#" style="color:#0D6EFD;">Terms & Conditions</a>
    </label>

    <button class="auth-btn" onclick="register()">Create Account</button>

    <div class="auth-switch">
      Already have an account? <a href="#" onclick="toggleAuth()">Login here</a>
    </div>

    <div id="regMsg" style="text-align:center;margin-top:12px;font-size:13px;"></div>
  </div>
</div>

<!-- FOOTER MINIMAL -->
<div style="background:#2B3445;color:#888;text-align:center;padding:16px;font-size:13px;">
  © 2026 Brand. All rights reserved.
</div>

<script src="app.js"></script>
<script>
  var API = 'http://localhost:5000/api';

  function toggleAuth() {
    var login = document.getElementById('loginCard');
    var reg   = document.getElementById('registerCard');
    if (login.style.display === 'none') {
      login.style.display = 'block';
      reg.style.display   = 'none';
    } else {
      login.style.display = 'none';
      reg.style.display   = 'block';
    }
  }

  function showMsg(id, text, isError) {
    var el = document.getElementById(id);
    el.style.color   = isError ? '#e74c3c' : '#28a745';
    el.textContent   = text;
  }

  function setBtn(id, text, disabled) {
    var btn = document.getElementById(id);
    if (btn) { btn.textContent = text; btn.disabled = disabled; }
  }

  // =============================================
  // LOGIN — JWT Backend
  // =============================================
  function login() {
    var email = document.getElementById('loginEmail').value.trim();
    var pass  = document.getElementById('loginPassword').value.trim();

    if (!email || !pass) {
      showMsg('loginMsg', 'Please fill in all fields!', true);
      return;
    }

    showMsg('loginMsg', 'Logging in...', false);

    // Try backend API first
    fetch(API + '/auth/login', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body:    JSON.stringify({ email: email, password: pass })
    })
    .then(function(res) { return res.json(); })
    .then(function(data) {
      if (data.success && data.token) {
        // ✅ Save JWT token + user info
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify({
          name:  data.user.name,
          email: data.user.email,
          role:  data.user.role,
          id:    data.user._id
        }));
        showMsg('loginMsg', '✅ Login successful! Redirecting...', false);
        setTimeout(function() { window.location.href = 'index.html'; }, 1000);
      } else {
        showMsg('loginMsg', data.message || 'Invalid email or password!', true);
      }
    })
    .catch(function() {
      // Backend offline — local fallback
      if (email === 'admin@brand.com' && pass === 'admin123') {
        localStorage.setItem('token', 'local-admin-token');
        localStorage.setItem('user', JSON.stringify({ name:'Admin', email:email, role:'admin' }));
        showMsg('loginMsg', '✅ Login successful! Redirecting...', false);
        setTimeout(function() { window.location.href = 'index.html'; }, 1000);
        return;
      }
      var users = JSON.parse(localStorage.getItem('users') || '[]');
      var found = users.find(function(u) { return u.email===email && u.password===pass; });
      if (found) {
        localStorage.setItem('token', 'local-token-' + Date.now());
        localStorage.setItem('user', JSON.stringify({ name:found.name, email:found.email, role:found.role||'user' }));
        showMsg('loginMsg', '✅ Login successful! Redirecting...', false);
        setTimeout(function() { window.location.href = 'index.html'; }, 1000);
      } else {
        showMsg('loginMsg', 'Invalid email or password!', true);
      }
    });
  }

  // =============================================
  // REGISTER — JWT Backend
  // =============================================
  function register() {
    var name    = document.getElementById('regName').value.trim();
    var email   = document.getElementById('regEmail').value.trim();
    var pass    = document.getElementById('regPassword').value.trim();
    var confirm = document.getElementById('regConfirm').value.trim();
    var terms   = document.getElementById('terms').checked;

    if (!name || !email || !pass || !confirm) {
      showMsg('regMsg', 'Please fill in all fields!', true); return;
    }
    if (pass !== confirm) {
      showMsg('regMsg', 'Passwords do not match!', true); return;
    }
    if (pass.length < 6) {
      showMsg('regMsg', 'Password must be at least 6 characters!', true); return;
    }
    if (!terms) {
      showMsg('regMsg', 'Please accept terms & conditions!', true); return;
    }

    showMsg('regMsg', 'Creating account...', false);

    // Try backend API first
    fetch(API + '/auth/register', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body:    JSON.stringify({ name: name, email: email, password: pass })
    })
    .then(function(res) { return res.json(); })
    .then(function(data) {
      if (data.success && data.token) {
        // ✅ Save JWT token + user info
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify({
          name:  data.user.name,
          email: data.user.email,
          role:  data.user.role,
          id:    data.user._id
        }));
        showMsg('regMsg', '✅ Account created! Redirecting...', false);
        setTimeout(function() { window.location.href = 'index.html'; }, 1000);
      } else {
        showMsg('regMsg', data.message || 'Registration failed!', true);
      }
    })
    .catch(function() {
      // Backend offline — local fallback
      var users = JSON.parse(localStorage.getItem('users') || '[]');
      if (users.find(function(u){ return u.email===email; })) {
        showMsg('regMsg', 'Email already registered!', true); return;
      }
      users.push({ name:name, email:email, password:pass, role:'user' });
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('token', 'local-token-' + Date.now());
      localStorage.setItem('user', JSON.stringify({ name:name, email:email, role:'user' }));
      showMsg('regMsg', '✅ Account created! Redirecting...', false);
      setTimeout(function() { window.location.href = 'index.html'; }, 1000);
    });
  }

  function socialLogin(provider) {
    localStorage.setItem('user', JSON.stringify({
      name:  provider + ' User',
      email: provider.toLowerCase() + '@brand.com',
      role:  'user'
    }));
    localStorage.setItem('token', 'social-token-' + Date.now());
    window.location.href = 'index.html';
  }

  // =============================================
  // GOOGLE LOGIN — Real OAuth
  // =============================================
  var GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID'; // Replace with your Client ID

  function googleLogin() {
    // Check if Google API loaded
    if (typeof google === 'undefined') {
      showMsg('loginMsg', '⚠️ Google login loading... try again!', true);
      return;
    }

    var client = google.accounts.oauth2.initTokenClient({
      client_id: GOOGLE_CLIENT_ID,
      scope: 'email profile',
      callback: function(response) {
        if (response.access_token) {
          // Get user info from Google
          fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
            headers: { Authorization: 'Bearer ' + response.access_token }
          })
          .then(function(res) { return res.json(); })
          .then(function(googleUser) {
            // Save user
            localStorage.setItem('user', JSON.stringify({
              name:   googleUser.name,
              email:  googleUser.email,
              avatar: googleUser.picture,
              role:   'user'
            }));
            localStorage.setItem('token', 'google-token-' + Date.now());
            showMsg('loginMsg', '✅ Google login successful! Redirecting...', false);
            setTimeout(function() { window.location.href = 'index.html'; }, 1000);
          })
          .catch(function() {
            showMsg('loginMsg', 'Google login failed!', true);
          });
        }
      }
    });
    client.requestAccessToken();
  }

  // Enter key support
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      var loginCard = document.getElementById('loginCard');
      if (loginCard.style.display !== 'none') login();
      else register();
    }
  });

  window.addEventListener('DOMContentLoaded', updateCartBadge);
</script>
<script src="navbar.js"></script>
</body>
</html>
